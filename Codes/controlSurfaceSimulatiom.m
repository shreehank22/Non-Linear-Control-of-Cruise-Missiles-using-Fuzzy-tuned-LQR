function controlSurfaceSimulation(options)
%   This function creates a control surface plot for a fuzzy system.
%   Input options is a gensurfOptions object, which specifies a set of
%   parameter values for control surface generation from a fuzzy system
%   with 2 inputs and 5 outputs.
if nargin==0
    options = gensurfOptions(...
        InputIndex='auto', ...
        OutputIndex='auto', ...
        NumGridPoints=15, ...
        ReferenceInputs='auto', ...
        NumSamplePoints=101 ...
        );
end

fis = constructFuzzySystem();
gensurf(fis,options);
end

function FLC_Final1 = constructFuzzySystem()
%% Constructs a fuzzy system.

% Construct FIS
FLC_Final1 = mamfis(Name="FLC_Final1");
% Input 1
FLC_Final1 = addInput(FLC_Final1,[-30 30],Name="e1");
FLC_Final1 = addMF(FLC_Final1,"e1","trapmf",[-41.25 -31.25 -25 -20], ...
    Name="NB",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e1","trimf",[-22.5 -12.5 -2.5], ...
    Name="NM",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e1","trimf",[-5 0 5], ...
    Name="Z",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e1","trimf",[2.5 12.5 22.5], ...
    Name="PB",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e1","trapmf",[20 25 31.25 41.25], ...
    Name="PM",VariableType="input");
% Input 2
FLC_Final1 = addInput(FLC_Final1,[-100 100],Name="e2");
FLC_Final1 = addMF(FLC_Final1,"e2","trapmf",[-137.5 -104.2 -80 -60], ...
    Name="NB",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e2","trimf",[-65 -40 -15], ...
    Name="NM",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e2","trimf",[-20 0 20], ...
    Name="Z",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e2","trimf",[15 40 65], ...
    Name="PM",VariableType="input");
FLC_Final1 = addMF(FLC_Final1,"e2","trapmf",[60 80 104.2 137.5], ...
    Name="PB",VariableType="input");
% Output 1
FLC_Final1 = addOutput(FLC_Final1,[0 120000],Name="q11");
FLC_Final1 = addMF(FLC_Final1,"q11","trapmf",[-45000 -5000 50000 65000], ...
    Name="S",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q11","trimf",[60000 80000 110000], ...
    Name="M",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q11","trapmf",[100000 110000 125000 165000], ...
    Name="B",VariableType="output");
% Output 2
FLC_Final1 = addOutput(FLC_Final1,[0 4000],Name="q22");
FLC_Final1 = addMF(FLC_Final1,"q22","trapmf",[-1499 -165.6 1700 2500], ...
    Name="S",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q22","trimf",[2200 2700 3500], ...
    Name="M",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q22","trapmf",[3000 3400 4167 5500], ...
    Name="B",VariableType="output");
% Output 3
FLC_Final1 = addOutput(FLC_Final1,[0 50],Name="q33");
FLC_Final1 = addMF(FLC_Final1,"q33","trapmf",[-17.38 -1.042 3.042 19.38], ...
    Name="S",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q33","trimf",[15.1 30.5 45.9167], ...
    Name="M",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q33","trapmf",[31.62 47.96 52.04 68.38], ...
    Name="B",VariableType="output");
% Output 4
FLC_Final1 = addOutput(FLC_Final1,[0 1],Name="q44");
FLC_Final1 = addMF(FLC_Final1,"q44","trapmf",[-0.375 -0.04167 0.4 0.7], ...
    Name="S",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q44","trimf",[0.6 0.7 0.85], ...
    Name="M",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"q44","trapmf",[0.8 0.85 1.042 1.375], ...
    Name="B",VariableType="output");
% Output 5
FLC_Final1 = addOutput(FLC_Final1,[0.005 0.05],Name="R");
FLC_Final1 = addMF(FLC_Final1,"R","trapmf",[-0.01188 0.003125 0.01 0.0125], ...
    Name="S",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"R","trimf",[0.008 0.015 0.02], ...
    Name="M",VariableType="output");
FLC_Final1 = addMF(FLC_Final1,"R","trapmf",[0.0155 0.0225 0.05188 0.06688], ...
    Name="B",VariableType="output");
% Rules
FLC_Final1 = addRule(FLC_Final1,[1 1 2 3 2 2 3 1 1; ...
    2 1 3 3 1 2 1 1 1; ...
    3 1 3 3 2 1 2 1 1; ...
    1 2 3 2 2 1 2 1 1; ...
    2 2 3 2 1 1 1 1 1; ...
    3 2 3 3 1 1 2 1 1; ...
    1 3 3 2 3 1 3 1 1; ...
    2 3 2 2 1 1 1 1 1; ...
    3 3 2 2 2 2 1 1 1; ...
    1 4 3 2 1 1 1 1 1; ...
    1 5 3 2 1 1 1 1 1; ...
    2 4 3 2 1 1 1 1 1; ...
    2 5 3 2 1 1 1 1 1; ...
    3 4 3 3 1 1 2 1 1; ...
    3 5 2 3 2 1 2 1 1; ...
    4 1 3 2 1 1 1 1 1; ...
    4 2 3 2 1 1 1 1 1; ...
    4 3 2 2 3 3 3 1 1; ...
    4 4 2 2 2 2 2 1 1; ...
    4 5 3 3 2 2 3 1 1; ...
    5 1 3 2 1 2 1 1 1; ...
    5 2 3 2 1 2 1 1 1; ...
    5 3 3 2 1 2 1 1 1; ...
    5 4 3 2 1 2 1 1 1; ...
    5 5 3 3 1 2 1 1 1]);
end